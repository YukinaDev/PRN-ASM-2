@page
@model EVDMS.WebApp.Pages.VehicleModels.IndexModel
@{
    ViewData["Title"] = "Vehicle Catalog";
}

<div class="page-header mb-4">
    <div>
        <h1 class="page-title">Vehicle Catalog</h1>
        <p class="page-subtitle">Quản lý danh mục xe điện, trạng thái phát hành và giá bán cơ sở.</p>
    </div>
    <div class="header-actions">
        <a asp-page="Create" class="btn btn-primary">
            <i class="bi bi-plus-circle me-1"></i> Thêm mẫu xe
        </a>
    </div>
</div>

@if (!string.IsNullOrWhiteSpace(Model.StatusMessage))
{
    <div class="alert alert-success alert-dismissible fade show shadow-sm" role="alert">
        @Model.StatusMessage
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<div class="row g-3 summary-grid mb-4">
    <div class="col-12 col-md-3">
        <div class="summary-card card border-0 shadow-sm">
            <div class="card-body">
                <div class="summary-label">Tổng số mẫu xe</div>
                <div class="summary-value text-primary">@Model.Summary.Total</div>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-3">
        <div class="summary-card card border-0 shadow-sm">
            <div class="card-body">
                <div class="summary-label">Đang kinh doanh</div>
                <div class="summary-value text-success">@Model.Summary.Active</div>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-3">
        <div class="summary-card card border-0 shadow-sm">
            <div class="card-body">
                <div class="summary-label">Đang soạn thảo</div>
                <div class="summary-value text-warning">@Model.Summary.Draft</div>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-3">
        <div class="summary-card card border-0 shadow-sm">
            <div class="card-body">
                <div class="summary-label">Ngừng kinh doanh</div>
                <div class="summary-value text-danger">@Model.Summary.Discontinued</div>
            </div>
        </div>
    </div>
</div>

<div class="card shadow-sm border-0 mb-4">
    <div class="card-body">
        <form method="get" class="row g-2 align-items-end filter-toolbar">
            <div class="col-12 col-sm-6 col-md-4">
                <label class="form-label">Trạng thái</label>
                <select class="form-select" asp-for="Status" asp-items="Model.StatusOptions"></select>
            </div>
            <div class="col-12 col-sm-6 col-md-4">
                <label class="form-label">Giá trung bình (toàn bộ)</label>
                <div class="display-6 fs-4 fw-semibold text-primary">
                    @Model.Summary.AverageBasePrice.ToString("C0")
                </div>
            </div>
            <div class="col-12 col-md-4 text-sm-end text-md-end text-start mt-3 mt-md-0">
                <button type="submit" class="btn btn-outline-primary me-2">Lọc danh sách</button>
                <a asp-page="Index" class="btn btn-link">Đặt lại</a>
            </div>
        </form>
    </div>
</div>

<div class="card shadow-sm border-0">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Mẫu xe</th>
                        <th class="text-nowrap">Mã</th>
                        <th class="text-nowrap">Phiên bản</th>
                        <th>Màu sắc</th>
                        <th class="text-end text-nowrap">Giá cơ sở</th>
                        <th>Trạng thái</th>
                        <th>Ghi chú</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                @if (Model.Vehicles.Count == 0)
                {
                    <tr>
                        <td colspan="8" class="text-center py-4 text-muted">
                            Chưa có mẫu xe nào phù hợp bộ lọc hiện tại.
                        </td>
                    </tr>
                }
                else
                {
                    foreach (var item in Model.Vehicles)
                    {
                        <tr>
                            <td>
                                <div class="fw-semibold">@item.Name</div>
                            </td>
                            <td>@item.ModelCode</td>
                            <td>@item.Version</td>
                            <td>@item.Color</td>
                            <td class="text-end">@item.BasePrice.ToString("C0")</td>
                            <td>
                                <span class="@GetStatusBadgeClass(item.Status)">@item.Status</span>
                            </td>
                            <td class="text-muted">@(!string.IsNullOrWhiteSpace(item.Notes) ? item.Notes : "--")</td>
                            <td class="text-end">
                                <div class="btn-group btn-group-sm" role="group">
                                    <a asp-page="Edit" asp-route-id="@item.Id" class="btn btn-outline-secondary">
                                        <i class="bi bi-pencil-square"></i>
                                    </a>
                                    <a asp-page="Delete" asp-route-id="@item.Id" class="btn btn-outline-danger">
                                        <i class="bi bi-trash"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                }
                </tbody>
            </table>
        </div>
    </div>
</div>

@functions {
    private static string GetStatusBadgeClass(VehicleStatus status) =>
        status switch
        {
            VehicleStatus.Active => "badge rounded-pill bg-success-subtle text-success-emphasis px-3 py-2",
            VehicleStatus.Draft => "badge rounded-pill bg-warning-subtle text-warning-emphasis px-3 py-2",
            VehicleStatus.Discontinued => "badge rounded-pill bg-danger-subtle text-danger-emphasis px-3 py-2",
            _ => "badge rounded-pill bg-secondary-subtle text-secondary-emphasis px-3 py-2"
        };
}
